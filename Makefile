
obj-m += mykeyboard.o

all:	
	gcc readdev.c -o readdev
	gcc writedev.c -o writedev
	@echo ">>" Compiling the Source $<
	@echo ".." $<
	make -C /lib/modules/$(shell uname -r)/build M=$(PWD) modules

header:
	@echo ">>" Creating Keyboard Mapping Header File $<
	@echo ".." $<
	$(shell echo 'dumpkeys | perl -lne "BEGIN {print qq!// Please DO-NOT edit this file manually (a hardware specific file).\n// This is generated by the Makefile.\n// Read License Agreement before using.\n// Author: Vigith Maurice <v\@vigith.com>\n\n!; print qq!struct keyboard_stat {\n  char str[10];\n  char hex[4];\n  int dec;\n  long int count_p;\n  long int count_r;\n} keyboard_stats[] = {\n  { \"DUMMY\", \"0\", 0, 0, 0 }, !}; if (m!^keycode\s+(\d+)\s+=\s+(.*?)\s+!) {printf qq!  { \"%s\", \"%x\", %d, 0, 0 },\n!, substr(\$$2,0,10),\$$1,\$$1; \$$count++ } END { \$$count++; print qq!};\n\nint SCAN_CODES = \$$count;! }" > keyboard_mapping.h' $<)
	@echo ".." $<


clean:	
	make -C /lib/modules/$(shell uname -r)/build M=$(PWD) clean
